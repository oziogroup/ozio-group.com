---
interface Stat {
  value: number;
  display: string;
  label: string;
}

interface Props {
  stats: {
    requests: Stat;
    revenue: Stat;
    artisans: Stat;
    years: Stat;
  };
}

const { stats } = Astro.props;

const statItems = [
  { ...stats.requests, suffix: 'K+', prefix: '', target: 25 },
  { ...stats.revenue, suffix: 'M+', prefix: 'â‚¬', target: 15 },
  { ...stats.artisans, suffix: '+', prefix: '', target: 2000 },
  { ...stats.years, suffix: '', prefix: '', target: 9 },
];
---

<section class="py-20 md:py-32 bg-surface">
  <div class="container mx-auto px-6">
    <div 
      class="grid grid-cols-2 md:grid-cols-4 gap-8 md:gap-12"
      data-stats-container
    >
      {statItems.map((stat, index) => (
        <div 
          class="text-center"
          data-animate="fade-up"
          style={`animation-delay: ${index * 100}ms`}
        >
          <div class="mb-3">
            <span 
              class="text-4xl md:text-5xl lg:text-6xl font-heading font-bold bg-gradient-to-r from-accent to-accent-hover bg-clip-text text-transparent"
              data-counter
              data-target={stat.target}
              data-suffix={stat.suffix}
              data-prefix={stat.prefix || ''}
            >
              {stat.display}
            </span>
          </div>
          <p class="text-text-secondary text-sm md:text-base">{stat.label}</p>
        </div>
      ))}
    </div>
  </div>
</section>

<script>
  import { gsap, ScrollTrigger } from '../../lib/animations';

  function initCounters() {
    const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    
    const counters = document.querySelectorAll('[data-counter]');
    
    counters.forEach((counter) => {
      const target = parseInt(counter.getAttribute('data-target') || '0', 10);
      const suffix = counter.getAttribute('data-suffix') || '';
      const prefix = counter.getAttribute('data-prefix') || '';
      
      if (prefersReducedMotion) {
        counter.textContent = `${prefix}${target}${suffix}`;
        return;
      }

      const counterObj = { value: 0 };
      
      ScrollTrigger.create({
        trigger: counter,
        start: 'top 80%',
        once: true,
        onEnter: () => {
          gsap.to(counterObj, {
            value: target,
            duration: 1.5,
            ease: 'power3.out',
            onUpdate: () => {
              const formatted = target >= 1000 
                ? Math.round(counterObj.value / 1000) + 'K'
                : Math.round(counterObj.value);
              const finalSuffix = target >= 1000 ? suffix.replace('K', '') : suffix;
              counter.textContent = `${prefix}${formatted}${finalSuffix}`;
            },
            onComplete: () => {
              const finalSuffix = target >= 1000 ? suffix.replace('K', '') : suffix;
              counter.textContent = `${prefix}${target >= 1000 ? Math.round(target / 1000) + 'K' : target}${finalSuffix}`;
            }
          });
        }
      });
    });
  }

  document.addEventListener('astro:page-load', initCounters);
  initCounters();
</script>
